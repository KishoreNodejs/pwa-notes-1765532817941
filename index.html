
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=yes" />
  <title>Notes</title>

  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/png" href="icon-192.png" />

  <meta name="theme-color" content="#ffffff" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Notes" />
  <link rel="apple-touch-icon" href="icon-512.png" />

  <style>
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
    }

    /* Install Button */
    #pwa-install-btn {
      position: fixed;
      right: 16px;
      bottom: 16px;
      padding: 10px 14px;
      border-radius: 999px;
      border: none;
      background: #ffffff;
      color: white;
      font-size: 14px;
      display: none;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      align-items: center;
      cursor: pointer;
      z-index: 9999;
    }
  </style>
</head>

<body>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Notes PWA</title>
    <meta name="theme-color" content="#6366F1"> <!-- Updated to a more modern purple/indigo -->
    <link rel="manifest" href="manifest.json">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Custom styles for better PWA feel and touch targets */
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';
        overscroll-behavior: contain;
      }
      .note-card {
        transition: all 0.3s ease;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
      }
      .note-card:hover {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.08);
        transform: translateY(-3px);
      }
      .btn-fab {
        width: 56px;
        height: 56px;
        border-radius: 50%;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2), 0 6px 6px rgba(0, 0, 0, 0.1);
      }
      textarea {
        resize: vertical;
      }
      /* Scrollbar styling for Webkit browsers */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #f0f4f8;
        /* Light background */
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb {
        background: #a0aec0;
        /* Tailwind's gray-400 */
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #718096;
        /* Tailwind's gray-500 */
      }
      /* Modal backdrop filter for a frosted glass effect */
      #note-modal.visible {
        backdrop-filter: blur(10px) saturate(150%);
        -webkit-backdrop-filter: blur(10px) saturate(150%);
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen flex flex-col text-gray-800">
    <header class="bg-indigo-600 text-white shadow-lg sticky top-0 z-50">
      <nav class="container mx-auto px-4 py-4 flex items-center justify-between">
        <div class="text-2xl font-extrabold flex items-center">
          <i class="fas fa-sticky-note mr-3"></i>
          <span class="text-white">MyNotes</span>
        </div>
        <button id="search-toggle-btn" class="md:hidden p-2 rounded-full hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-700 focus:ring-opacity-50">
          <i class="fas fa-search"></i>
        </button>
        <div id="search-bar" class="hidden md:flex items-center bg-white bg-opacity-20 rounded-lg p-2 shadow-sm w-1/3 lg:w-1/2 min-w-[200px]">
          <i class="fas fa-search text-white text-opacity-70 mr-2"></i>
          <input type="text" id="search-input" placeholder="Search notes..." class="focus:outline-none w-full bg-transparent text-white placeholder-white placeholder-opacity-70 border-none p-0 text-sm">
        </div>
      </nav>
      <div id="mobile-search-bar" class="md:hidden px-4 pb-4 hidden">
        <div class="flex items-center bg-white bg-opacity-20 rounded-lg p-2 shadow-sm w-full">
          <i class="fas fa-search text-white text-opacity-70 mr-2"></i>
          <input type="text" id="mobile-search-input" placeholder="Search notes..." class="focus:outline-none w-full bg-transparent text-white placeholder-white placeholder-opacity-70 border-none p-0 text-sm">
        </div>
      </div>
    </header>
    <main id="notes-list-container" class="flex-1 overflow-y-auto p-4 sm:p-6">
      <div id="notes-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6">
        <!-- Notes will be loaded here by JavaScript -->
        <div class="text-center py-16 text-gray-500 hidden" id="no-notes-message">
          <i class="fas fa-lightbulb fa-3x mb-4 text-indigo-400"></i>
          <p class="text-lg font-semibold">Your notes will appear here.</p>
          <p class="mt-2">Tap the '+' button to create your first note!</p>
        </div>
        <div class="text-center py-16 text-gray-500 hidden" id="no-search-results">
          <i class="fas fa-exclamation-circle fa-3x mb-4 text-red-400"></i>
          <p class="text-lg font-semibold">No notes found matching your search.</p>
          <p class="mt-2">Try a different search term or clear the search bar.</p>
        </div>
      </div>
    </main>
    <!-- Floating Action Button (FAB) -->
    <button id="add-note-btn" class="btn-fab fixed bottom-6 right-6 bg-indigo-600 text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-700 focus:ring-opacity-50 z-40">
      <i class="fas fa-plus"></i>
    </button>
    <!-- Add/Edit Note Modal -->
    <div id="note-modal" class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 hidden p-4" style="backdrop-filter: blur(8px);">
      <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-auto p-6 md:p-8 relative transform transition-all duration-300 scale-95 opacity-0">
        <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 focus:outline-none transition duration-200">
          <i class="fas fa-times text-2xl"></i>
        </button>
        <h2 id="modal-title" class="text-3xl font-bold mb-5 text-indigo-700">New Note</h2>
        <input type="hidden" id="note-id">
        <div class="mb-5">
          <label for="note-title" class="block text-sm font-medium text-gray-700 mb-1">Title</label>
          <input type="text" id="note-title" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm text-base" placeholder="Note Title" required>
        </div>
        <div class="mb-6">
          <label for="note-content" class="block text-sm font-medium text-gray-700 mb-1">Content</label>
          <textarea id="note-content" rows="10" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm text-base" placeholder="Write your note here..." required></textarea>
        </div>
        <div class="flex justify-between items-center pt-4 border-t border-gray-200">
          <button id="delete-note-btn" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 transition duration-200 hidden">
            Delete
          </button>
          <button id="save-note-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-700 transition duration-200 ml-auto">
            Save
          </button>
        </div>
      </div>
    </div>
    <script>
      const notesList = document.getElementById('notes-list');
      const addNoteBtn = document.getElementById('add-note-btn');
      const noteModal = document.getElementById('note-modal');
      const closeModalBtn = document.getElementById('close-modal-btn');
      const saveNoteBtn = document.getElementById('save-note-btn');
      const deleteNoteBtn = document.getElementById('delete-note-btn');
      const noteIdInput = document.getElementById('note-id');
      const noteTitleInput = document.getElementById('note-title');
      const noteContentTextarea = document.getElementById('note-content');
      const modalTitle = document.getElementById('modal-title');
      const noNotesMessage = document.getElementById('no-notes-message');
      const noSearchResultsMessage = document.getElementById('no-search-results');
      const searchInput = document.getElementById('search-input');
      const mobileSearchInput = document.getElementById('mobile-search-input');
      const searchToggleBtn = document.getElementById('search-toggle-btn');
      const mobileSearchBar = document.getElementById('mobile-search-bar');
      const STORAGE_KEY = 'modernNotesPWA';
      let notes = [];
      let currentFilter = '';
      let isModalOpen = false;
      function loadNotes() {
        const storedNotes = localStorage.getItem(STORAGE_KEY);
        if (storedNotes) {
          notes = JSON.parse(storedNotes);
        }
        renderNotes();
      }
      function saveNotes() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(notes));
      }
      function getNextId() {
        if (notes.length === 0) return 1;
        return Math.max(...notes.map(note => note.id)) + 1;
      }
      function addNote(title, content) {
        const newNote = {
          id: getNextId(),
          title: title || 'Untitled Note',
          content: content,
          timestamp: new Date().toISOString()
        };
        notes.push(newNote);
        notes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)); // Sort by newest first
        saveNotes();
        renderNotes();
      }
      function updateNote(id, title, content) {
        const noteIndex = notes.findIndex(note => note.id === id);
        if (noteIndex > -1) {
          notes[noteIndex].title = title || 'Untitled Note';
          notes[noteIndex].content = content;
          notes[noteIndex].timestamp = new Date().toISOString();
          notes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
          saveNotes();
          renderNotes();
        }
      }
      function deleteNote(id) {
        notes = notes.filter(note => note.id !== id);
        saveNotes();
        renderNotes();
      }
      function renderNotes() {
        notesList.innerHTML = '';
        const filteredNotes = currentFilter ?
          notes.filter(note =>
            note.title.toLowerCase().includes(currentFilter.toLowerCase()) ||
            note.content.toLowerCase().includes(currentFilter.toLowerCase())
          ) :
          notes;
        if (filteredNotes.length === 0) {
          if (currentFilter) {
            noSearchResultsMessage.classList.remove('hidden');
            noNotesMessage.classList.add('hidden');
          } else {
            noNotesMessage.classList.remove('hidden');
            noSearchResultsMessage.classList.add('hidden');
          }
          notesList.appendChild(noNotesMessage);
          notesList.appendChild(noSearchResultsMessage);
          return;
        } else {
          noNotesMessage.classList.add('hidden');
          noSearchResultsMessage.classList.add('hidden');
        }
        filteredNotes.forEach(note => {
          const noteCard = document.createElement('div');
          noteCard.className = 'note-card bg-white rounded-lg p-5 cursor-pointer hover:shadow-lg transition duration-300 flex flex-col justify-between';
          noteCard.dataset.id = note.id;
          noteCard.innerHTML = `
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-2 truncate">${note.title}</h3>
                        <p class="text-gray-600 text-sm line-clamp-3">${note.content.substring(0, 100)}${note.content.length > 100 ? '...' : ''}</p>
                    </div>
                    <p class="text-xs text-gray-400 mt-4">${new Date(note.timestamp).toLocaleDateString()} ${new Date(note.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</p>
                `;
          noteCard.addEventListener('click', () => openModalForEdit(note));
          notesList.appendChild(noteCard);
        });
      }
      function openModal(note = null) {
        if (isModalOpen) return;
        isModalOpen = true;
        noteModal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        const modalContent = noteModal.querySelector('.max-w-md'); // Target the modal content div
        modalContent.style.transform = 'scale(0.95)';
        modalContent.style.opacity = '0';
        setTimeout(() => {
          modalContent.style.transform = 'scale(1)';
          modalContent.style.opacity = '1';
          noteModal.style.backdropFilter = 'blur(8px)'; // Apply backdrop filter after showing
          noteModal.style.webkitBackdropFilter = 'blur(8px)';
        }, 50);
        if (note) {
          modalTitle.textContent = 'Edit Note';
          noteIdInput.value = note.id;
          noteTitleInput.value = note.title;
          noteContentTextarea.value = note.content;
          deleteNoteBtn.classList.remove('hidden');
        } else {
          modalTitle.textContent = 'New Note';
          noteIdInput.value = '';
          noteTitleInput.value = '';
          noteContentTextarea.value = '';
          deleteNoteBtn.classList.add('hidden');
        }
      }
      function closeModal() {
        if (!isModalOpen) return;
        const modalContent = noteModal.querySelector('.max-w-md');
        modalContent.style.transform = 'scale(0.95)';
        modalContent.style.opacity = '0';
        noteModal.style.backdropFilter = 'blur(0px)'; // Remove backdrop filter
        noteModal.style.webkitBackdropFilter = 'blur(0px)';
        setTimeout(() => {
          noteModal.classList.add('hidden');
          document.body.style.overflow = '';
          isModalOpen = false;
          // Clear modal fields only after animation
          noteTitleInput.value = '';
          noteContentTextarea.value = '';
          noteIdInput.value = '';
          deleteNoteBtn.classList.add('hidden');
        }, 300);
      }
      function openModalForEdit(note) {
        openModal(note);
      }
      addNoteBtn.addEventListener('click', () => openModal());
      closeModalBtn.addEventListener('click', closeModal);
      saveNoteBtn.addEventListener('click', () => {
        const id = parseInt(noteIdInput.value);
        const title = noteTitleInput.value.trim();
        const content = noteContentTextarea.value.trim();
        if (!title && !content) {
          alert("Note cannot be empty.");
          return;
        }
        if (!title) {
          alert("Please add a title.");
          return;
        }
        if (!content) {
          alert("Please add content.");
          return;
        }
        if (id) {
          updateNote(id, title, content);
        } else {
          addNote(title, content);
        }
        closeModal();
      });
      deleteNoteBtn.addEventListener('click', () => {
        const id = parseInt(noteIdInput.value);
        if (id && confirm('Are you sure you want to delete this note?')) {
          deleteNote(id);
          closeModal();
        }
      });
      searchInput.addEventListener('input', (e) => {
        currentFilter = e.target.value;
        renderNotes();
      });
      mobileSearchInput.addEventListener('input', (e) => {
        currentFilter = e.target.value;
        renderNotes();
      });
      searchToggleBtn.addEventListener('click', () => {
        mobileSearchBar.classList.toggle('hidden');
        if (!mobileSearchBar.classList.contains('hidden')) {
          mobileSearchInput.focus();
        }
      });
      // Prevent closing modal by clicking outside and clicking on the modal content itself
      noteModal.addEventListener('click', (e) => {
        if (e.target === noteModal) {
          closeModal();
        }
      });
      // Handle Enter key for save and Escape key for close
      noteTitleInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          noteContentTextarea.focus();
          e.preventDefault();
        }
      });
      noteContentTextarea.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) { // Allow shift+enter for new lines
          saveNoteBtn.click();
          e.preventDefault();
        }
      });
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && isModalOpen) {
          closeModal();
        }
      });
      // --- PWA Service Worker Registration (Basic) ---
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js')
          .then(function(registration) {
            console.log('Service worker registered successfully with scope:', registration.scope);
          })
          .catch(function(err) {
            console.log('Service worker registration failed:', err);
          });
      }
      // --- Initial Load ---
      loadNotes();
    </script>
    <!-- Basic manifest.json content for PWA functionality -->
    <script>
      const manifest = {
        "name": "Modern Notes",
        "short_name": "Notes",
        "description": "A modern notes taking PWA",
        "start_url": "/",
        "display": "standalone",
        "background_color": "#6366F1",
        "theme_color": "#6366F1",
        "icons": [{
            "src": "icons/icon-192x192.png",
            "sizes": "192x192",
            "type": "image/png"
          },
          {
            "src": "icons/icon-512x512.png",
            "sizes": "512x512",
            "type": "image/png"
          }
        ]
      };
      const blob = new Blob([JSON.stringify(manifest)], {
        type: 'application/json'
      });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('link');
      link.rel = 'manifest';
      link.href = url;
      document.head.appendChild(link);
    </script>
  </body>
</html>

<button id="pwa-install-btn" onclick="installPWA()">Install App</button>

<script>
// Register service worker
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js')
      .then(reg => console.log('SW registered'))
      .catch(err => console.error('SW error:', err));
  });
}

let deferredPrompt;

// Capture installation prompt
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;

  const btn = document.getElementById('pwa-install-btn');
  if (btn) btn.style.display = 'flex';
});

// Called when user taps Install button
window.installPWA = async function () {
  const btn = document.getElementById('pwa-install-btn');

  if (!deferredPrompt) {
    if (btn) btn.style.display = 'none';
    return 'not_available';
  }

  deferredPrompt.prompt();
  const { outcome } = await deferredPrompt.userChoice;
  deferredPrompt = null;

  if (btn) btn.style.display = 'none';

  return outcome;
};
</script>

</body>
</html>